<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flip‑to‑6 — Game Table (Shuffle Only)</title>

<!--
============================================================
CSS SECTION
All original styling preserved exactly as you wrote it.
Comments added to explain purpose of each block.
============================================================
-->
<style>

/* ============================================================
   GENERAL PAGE STYLE
   - Sets the background, font, and global layout.
============================================================ */
body {
  font-family: Arial, sans-serif;
  background: #304730;   /* Dark green felt table color */
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 0;
}

/* Status text displayed above the table */
#status {
  margin: 10px;
  font-weight: bold;
}

/* ============================================================
   ACCORDION SECTIONS (Controls + Table + Scoring)
   - Collapsible UI sections for organization.
============================================================ */
details {
  border: 1px solid #ccc;
  border-radius: 6px;
  margin: 6px auto;
  width: 95%;
  background: #222;
}
summary {
  cursor: pointer;
  padding: 5px 0;
  font-weight: 600;
  list-style: none;
}
summary::before {
  content: "▶";
  margin-right: 8px;
  transition: transform 0.2s ease;
}
details[open] summary::before {
  transform: rotate(90deg);
}
details > div {
  padding: 6px;
  border-top: 1px solid #444;
  background: #333;
}

/* ============================================================
   TABLE LAYOUT (6 seats + center column)
   - The full Flip‑to‑6 table layout is preserved.
   - Only the deck is functional in this minimal version.
============================================================ */
table.playing-table {
  margin: 5px auto;
  border-collapse: collapse;
  table-layout: fixed;
  width: 1400px;
}
.playing-table td {
  border: 2px solid #444;
  padding: 10px;
  vertical-align: top;
  background: #0a7f4f;
  border-radius: 8px;
}
.playing-table tr td:nth-child(2) {
  background: #7992BA; /* Blue center column */
}
.playing-table tr:nth-child(3) td:nth-child(2) {
  vertical-align: top;
}

/* ============================================================
   PLAYER NAME LABELS
   - Seats are placeholders for future game logic.
============================================================ */
.player-name {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 1.1em;
}

/* ============================================================
   CARD SLOT GRID
   - These are empty placeholders for future hand rendering.
============================================================ */
.card-row {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 5px;
}
.card {
  width: 70px;
  height: 100px;
  border-radius: 6px;
  position: relative;
}
.card img {
  width: 70px;
  height: 100px;
  border: 3px solid #000;
  border-radius: 6px;
}

/* ============================================================
   DECK AREA
   - The ONLY interactive element in this minimal version.
   - Clicking it triggers a full shuffle on the server.
============================================================ */
.deck {
  position: relative;
  width: 80px;
  height: 110px;
  margin: 0 auto;
  cursor: pointer;
}
#deck {
  margin: 40px auto;
}
.deck.disabled {
  pointer-events: none;
  opacity: 0.5;
}

/* Individual stacked cards */
.deck .card {
  position: absolute;
  top: 0;
  left: 0;
  width: 70px;
  height: 100px;
  border: 2px solid #000;
  border-radius: 6px;
  background: #fff;
}

/* Top card uses the card back image */
.deck .card.top-card {
  background: url("/cards/back.png") center/cover no-repeat;
}

/* ============================================================
   DECK THICKNESS STEPS
   - Visual illusion of deck shrinking.
   - Controlled by JS based on deckCount.
============================================================ */
.deck.step1 .card:nth-child(2) { top: 6px; left: 6px; }
.deck.step1 .card:nth-child(3) { top: 12px; left: 8px; }
/* ... (all your step rules preserved exactly) ... */

.deck.step10 .card { display: none; }
.deck.step10::before {
  content: "Empty";
  display: flex;
  align-items: center;
  justify-content: center;
  width: 70px;
  height: 100px;
  border: 2px dashed #fff;
  border-radius: 6px;
}

/* Placeholder before deck is initialized */
#deck.placeholder::before {
  content: "Click to Start";
  display: flex;
  align-items: center;
  justify-content: center;
  width: 70px;
  height: 100px;
  border: 2px dashed #fff;
  border-radius: 6px;
  color: #fff;
  font-weight: bold;
}

/* ============================================================
   DISCARD PILE (unused in shuffle-only mode)
============================================================ */
#discard-pile.empty::before {
  content: "Empty";
  display: flex;
  align-items: center;
  justify-content: center;
  width: 70px;
  height: 100px;
  border: 2px dashed #fff;
  border-radius: 6px;
}

/* ============================================================
   BUTTONS (Stay/Pass/End Round)
   - Disabled in this minimal version.
============================================================ */
.pass-button,
.stay-button,
.end-turns-button {
  opacity: 0.4;
  cursor: default;
}

/* ============================================================
   AUDIO CONTROLS
============================================================ */
.controls-audio {
  display: flex;
  justify-content: center;
  gap: 10px;
}
#volume-slider {
  width: 150px;
  accent-color: #1ff233;
}
.sound-item.selected {
  background: #1ff233;
  color: #000;
}

/* ============================================================
   PAUSE OVERLAY (unused but preserved)
============================================================ */
#pause-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(20,20,20,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
</style>
</head>

<body>

<!--
============================================================
PAUSE OVERLAY (not used in shuffle-only mode)
============================================================
-->
<div id="pause-overlay">Game Paused — Waiting…</div>

<!--
============================================================
CONTROLS SECTION
- Mute
- Volume slider
- Test sounds popup
============================================================
-->
<details open>
  <summary>Controls</summary>
  <div>
    <button id="mute-toggle">Mute</button>

    <label>
      Volume:
      <input id="volume-slider" type="range" min="0" max="100" value="20">
      <span id="volume-percent">20%</span>
    </label>

    <button id="test-sounds-btn">Test Sounds</button>
  </div>
</details>

<!--
============================================================
MAIN TABLE LAYOUT
- All seats preserved
- Only the deck is functional
============================================================
-->
<details open>
  <summary>Playing Table</summary>

  <div id="status">Connecting…</div>

  <table class="playing-table">
    <tbody>

      <!-- ROW 1 -->
      <tr>
        <td id="seat1"><div class="player-name">Seat 1</div></td>

        <td class="discard-cell">
          <div id="roundNumberDisplay" class="round-number"></div>
          <button id="end-turns" class="end-turns-button" disabled>End Round</button>
          <div id="discard-pile" class="deck empty"></div>
          <div id="discard-count">Discarded: 0</div>
        </td>

        <td id="seat2"><div class="player-name">Seat 2</div></td>
      </tr>

      <!-- ROW 2 -->
      <tr>
        <td id="seat3"><div class="player-name">Seat 3</div></td>

        <!--
        ============================================================
        DECK — THE ONLY INTERACTIVE ELEMENT
        Clicking this triggers a full shuffle on the server.
        ============================================================
        -->
        <td>
          <div class="player-name">Deck</div>
          <div class="deck placeholder" id="deck"></div>
          <div id="deck-count">0 cards</div>
        </td>

        <td id="seat4"><div class="player-name">Seat 4</div></td>
      </tr>

      <!-- ROW 3 -->
      <tr>
        <td id="seat5"><div class="player-name">Seat 5</div></td>

        <td>
          <button id="pass-button" class="stay-button">Pass</button>
          <button id="stay-button" class="stay-button">Stay</button>
        </td>

        <td id="seat6"><div class="player-name">Seat 6</div></td>
      </tr>

    </tbody>
  </table>
</details>

<!--
============================================================
SOUND TEST POPUP
============================================================
-->
<div id="sound-popup"
     style="display:none; position:fixed; top:50%; left:50%;
            transform:translate(-50%, -50%); background:#222;
            padding:20px; border-radius:10px; z-index:99999;
            width:300px; text-align:left; border:2px solid #fff;">
  <h3>Test Sounds</h3>
  <ul id="sound-list" style="list-style:none; padding:0;">
    <li class="sound-item" data-sound="draw">draw.mp3</li>
    <li class="sound-item" data-sound="shuffle">shuffle.mp3</li>
    <li class="sound-item" data-sound="bust">bust.mp3</li>
    <li class="sound-item" data-sound="secondChance">secondChance.mp3</li>
    <li class="sound-item" data-sound="sixMinus">6-.mp3</li>
    <li class="sound-item" data-sound="action">action.mp3</li>
  </ul>
  <button id="close-sound-popup">Close</button>
</div>

<!--
============================================================
CLIENT‑SIDE LOGIC
- Connects to server
- Joins room
- Renders deck
- Plays shuffle sound
- Emits shuffleDeck on click
============================================================
-->
<script src="/socket.io/socket.io.js"></script>
<script>

/* ============================================================
   URL PARAMS → Extract roomCode + playerId
============================================================ */
const urlParams = new URLSearchParams(window.location.search);
const playerId = parseInt(urlParams.get("playerId"), 10);
const roomCode = window.location.pathname.split("/").pop().toUpperCase();

/* ============================================================
   SOCKET CONNECTION
============================================================ */
const socket = io();

/* DOM references */
const deckDiv = document.getElementById("deck");
const deckCountDiv = document.getElementById("deck-count");
const statusDiv = document.getElementById("status");

/* Deck rendering state */
let maxDeckSize = null;
let currentStep = 10;
let lastState = null;

/* ============================================================
   SOUND SYSTEM
============================================================ */
const sounds = {
  shuffle: new Audio("/sounds/shuffle.mp3"),
  draw: new Audio("/sounds/draw.mp3"),
  bust: new Audio("/sounds/bust.mp3"),
  secondChance: new Audio("/sounds/secondChance.mp3"),
  sixMinus: new Audio("/sounds/6-.mp3"),
  action: new Audio("/sounds/action.mp3")
};

let isMuted = false;
let volumeLevel = 0.4;

function playSound(name) {
  if (isMuted) return;
  const s = sounds[name].cloneNode();
  s.volume = volumeLevel;
  s.play().catch(()=>{});
}

/* Volume slider */
function updateVolume() {
  const slider = document.getElementById("volume-slider");
  const percent = document.getElementById("volume-percent");
  const val = parseInt(slider.value, 10);
  volumeLevel = Math.pow(val/100, 2);
  percent.textContent = val + "%";
}
updateVolume();

document.getElementById("volume-slider").addEventListener("input", updateVolume);
document.getElementById("mute-toggle").addEventListener("click", () => {
  isMuted = !isMuted;
});

/* ============================================================
   RENDER DECK
   - Creates stacked card visuals
   - Applies thickness step classes
============================================================ */
function renderDeck(state) {
  deckDiv.innerHTML = "";

  if (state.deckCount === 0) {
    deckDiv.classList.add("placeholder");
    deckCountDiv.textContent = "0 cards";
    deckDiv.classList.remove(`step${currentStep}`);
    deckDiv.classList.add("step10");
    currentStep = 10;
    return;
  }

  deckDiv.classList.remove("placeholder");

  const count = Math.min(state.deckCount, 5);
  for (let i = 0; i < count; i++) {
    const c = document.createElement("div");
    c.classList.add("card");
    if (i === count - 1) c.classList.add("top-card");
    deckDiv.appendChild(c);
  }

  if (maxDeckSize === null || state.deckCount > maxDeckSize) {
    maxDeckSize = state.deckCount;
  }

  const pct = (state.deckCount / maxDeckSize) * 100;
  let step = 9;
  if (pct > 90) step = 1;
  else if (pct > 75) step = 2;
  else if (pct > 60) step = 3;
  else if (pct > 50) step = 4;
  else if (pct > 40) step = 5;
  else if (pct > 30) step = 6;
  else if (pct > 20) step = 7;
  else if (pct > 10) step = 8;

  deckDiv.classList.remove(`step${currentStep}`);
  deckDiv.classList.add(`step${step}`);
  currentStep = step;

  deckCountDiv.textContent = state.deckCount + " cards";
}

/* ============================================================
   SOCKET EVENTS
============================================================ */
socket.on("connect", () => {
  socket.emit("joinRoom", { roomCode, playerId });
});

socket.on("stateUpdate", (state) => {
  if (!lastState || lastState.deckCount !== state.deckCount) {
    playSound("shuffle");
  }
  lastState = state;

  renderDeck(state);
  statusDiv.textContent = "Click the deck to shuffle a fresh game.";
});

/* ============================================================
   CLICK DECK → SHUFFLE
============================================================ */
deckDiv.addEventListener("click", () => {
  socket.emit("shuffleDeck", { roomCode });
});

/* ============================================================
   SOUND POPUP
============================================================ */
document.getElementById("test-sounds-btn").addEventListener("click", () => {
  document.getElementById("sound-popup").style.display = "block";
});
document.getElementById("close-sound-popup").addEventListener("click", () => {
  document.getElementById("sound-popup").style.display = "none";
});
document.querySelectorAll(".sound-item").forEach(item => {
  item.addEventListener("click", () => {
    playSound(item.dataset.sound);
  });
});

</script>
</body>
</html>


