<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Flip-6: Draw Pile Viewer</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #fff;
      padding: 20px;
    }

    .card {
      width: 60px;
      height: 90px;
      border-radius: 6px;
      border: 2px solid #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 4px;
      font-size: 20px;
      font-weight: bold;
      background: #333;
      color: #fff;
    }

    .action {
      background: purple;
      border-color: #ffb3ff;
    }

    #pile {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    #roomInput {
      width: 120px;
      padding: 6px;
      font-size: 16px;
    }

    button {
      padding: 6px 12px;
      font-size: 16px;
      margin-left: 10px;
    }
  </style>
</head>

<body>

  <h1>Draw Pile Viewer</h1>

  <div>
    <input id="roomInput" placeholder="Room Code">
    <button onclick="loadPile()">Load</button>
  </div>

  <h3 id="count"></h3>

  <div id="pile"></div>

  <script>
    function isAction(value) {
      return !/^(?:[0-9]|1[0-2])$/.test(value);
    }

    async function loadPile() {
      const code = document.getElementById("roomInput").value.trim().toUpperCase();
      if (!code) return;

      const res = await fetch(`/api/room/${code}/draw-pile`);
      const data = await res.json();

      if (!data.success) {
        alert("Error: " + (data.error || "Unknown"));
        return;
      }

      const pile = data.drawPile;
      document.getElementById("count").textContent = `Cards: ${pile.length}`;

      const pileDiv = document.getElementById("pile");
      pileDiv.innerHTML = "";

      pile.forEach(card => {
        const div = document.createElement("div");
        div.classList.add("card");
        if (isAction(card.value)) div.classList.add("action");
        div.textContent = card.value;
        pileDiv.appendChild(div);
      });
    }
  </script>

</body>
</html>
